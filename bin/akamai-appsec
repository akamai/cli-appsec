#!/usr/bin/env node

"use strict";

var fs = require('fs');

require("sywac")
  .commandDirectory('./commands')
  .boolean("--json", {
    desc: "Print the raw json response. All commands respect this option.",
    group: "Command options:",
    required: false
  })
  .string("--edgerc", {
    desc: "The full path to the .edgerc file.",
    group: "Command options:",
    required: false
  })
  .string("--section", {
    desc: "The section of .edgerc to use.",
    group: "Command options:",
    required: false
  })
  .showHelpByDefault()
  .help("--help", {
    group: "Command options:",
    desc: "Prints help information."
  })
  .boolean("--version", {
    group: "Command options:",
    desc: "Current version of the program."
  })
  .epilogue("Copyright (C) Akamai Technologies, Inc\nVisit http://github.com/akamai/cli-appsec for detailed documentation\n")
  .outputSettings({
    maxWidth: 100
  })
  .parse()
  .then(result => {
    if (result.errors.length) {
      console.error("ERROR: ", result.errors[0] || JSON.stringify(result.errors[0]));
      console.output = "";
    }
    // if help requested, log it and exit
    
    //console.log("---"+JSON.stringify(result));
    if(result.argv.version && result.details.args.length == 1) {
      //print version info
      let s = fs.readFileSync(__dirname+'/../package.json', 'utf8');
      console.log(JSON.parse(s).version);
      process.exit(0);
    }
    else if (result.output) {
      console.log(result.output);
      process.exit(result.code);
    }
  });
